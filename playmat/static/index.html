<!DOCTYPE HTML>
<html lang="en">
	<head>
		<title>Playmat for role playing games</title>
		<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
		<script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>
		<link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/ui-darkness/jquery-ui.css">
		<link rel="stylesheet" type="text/css" href="./style.css">
		<link rel="icon" type="image/x-icon" href="favicon.ico">
		<script>
			betterAlert = function(message, title) {
				if (!title)
					title = 'Alert';
				if (!message)
					message = 'No Message to Display.';

				$('<div></div>').html(message).dialog({
					title: title,
					resizable: false,
					modal: true,
					buttons: {
						'Ok': function()  {
							$(this).dialog('close');
						}
					}
				});
			}
			
			check = function (fields) {
				for (var i = 0 ; i < fields.length ; i++) {
					var text ;
					if ($('input[name='+fields[i]+']').attr('type') == 'radio') {
						text = $('input[name='+fields[i]+']:checked').val() ;
					} else {
						text = $('input[name='+fields[i]+']').val() ;
					}
					if (text == undefined || text == '') {
						return false ;
					}
				}
				return true ;
			}
			
			$(function(){
				$("#createButton").on("click",function(){
					try { $("#joinDialog").dialog("close"); } catch(e) {} ;
					$("#createDialog").dialog({
						title: 'Create new playmat',
						show: { 
							effect: "fadeIn", duration: 600 
						},
						buttons: [{
							text:'Create',
							modal: true,
							click: function() {
								if (check(['playmatName','playmatPass','playerName'])) {
									$.post('/createPlaymat', 
										{ 
											playmat:  $('input[name=playmatName]').val(), 
											password: $('input[name=playmatPass]').val()
										},
										function (data) {
											data = JSON.parse(data);
											if (data.success == false) {
												betterAlert(data.error);
											} else {
											}
										});
								} else {
									betterAlert('Incomplete information');
								}
							}
						}]
					});
				});
				$("#joinButton").on("click",function(){
					try { $("#createDialog").dialog("close"); } catch(e) {} ;
					$("#joinDialog").dialog({
						title: 'Join an existing playmat',
						show: { 
							effect: "fadeIn", duration: 600 
						},
						buttons: [{
							text:'Join',
							click: function() {
								if (check(['joinPlaymat','joinPass','joinPlayer'])) {
									$.post('/checkPassword', 
										{ 
											playmat:  $('input[name=joinPlaymat]').val(), 
											password: $('input[name=joinPass]').val()
										},
										function (data) {
											data = JSON.parse(data);
											if (data.success == false) {
												betterAlert(data.error);
											} else {
											}
										});
								} else {
									betterAlert('Incomplete information');
								}
							}
						}]
					});
					$('#joinSpinner').show();
					$('#joinList').empty();
					$.get('/getAllPlaymats',function(data){
						$('#joinSpinner').hide();
						var dat = JSON.parse(data);
						$('#joinList').empty();
						for (var i = 0 ; i < dat.playmats.length ; i++) {
							var name = dat.playmats[i].name ;
							$('#joinList').append('<input type="radio" '+
							                             'name="joinPlaymat" '+
														 'value="'+name+'">'+name+
												  '</input><br/>');
						}
					});
				});
			});
		</script>
	</head>
	<body>
		<div class="menuCenter">
			<button class="coolButton" id="createButton">Create a new playmat</button>
			<button class="coolButton" id="joinButton"  >Join an existing playmat</button>
		</div>
		
		<form class="dialog" id="createDialog" style="display: none">
			<label for="playmatName">Playmat name</label><br/>
			<input name="playmatName"><br/><br/>
			<label for="playmatPass">Password</label><br/>
			<input name="playmatPass" type="password"><br/><br/>
			<label for="playerName">Player name</label><br/>
			<input name="playerName"><br/><br/>
		</form>
		
		<form class="dialog" id="joinDialog" style="display: none">
			<label for="joinPlaymat">Playmat name</label><br/><br/>
			<div id="joinList">
			</div>
			<img id="joinSpinner" src="loader.gif" class="spinner"/><br/>
			<label for="joinPass">Password</label><br/>
			<input name="joinPass" type="password"><br/><br/>
			<label for="joinPlayer">Player name</label><br/>
			<input name="joinPlayer">
		</form>
	</body>
</html>