<!DOCTYPE HTML>
<html lang="en">
	<head>
		<title>Playmat for role playing games</title>
		<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
		<script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>
		<script src="./helper.js"></script>
		<script src="./board.js"></script>
		
		<link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/ui-darkness/jquery-ui.css">
		<link rel="stylesheet" type="text/css" href="./style.css">
		<link rel="icon" type="image/x-icon" href="favicon.ico">
		<script>
			$(function() {				
				var menuTemplate = {
					autoOpen: false,
					width: 410,
					show: {
						effect: "blind",
						duration: 500
					},
					hide: {
						effect: "blind",
						duration: 500
					}
				};
			
				var id = $('#playmatId').val();
				if (id == -1) {
					betterAlert('An error has ocurrerd, redirecting to main screen', 'Error', function(){
						window.location.href = 'index.html' ;
					});
				} else {
					processBoard(JSON.parse($('#initialData').val()));
				
					$('#mainMenu').dialog($.extend(true,{
						title: 'Main menu',
						position: { 
							my: "left top+5", 
							at: "left bottom", 
							of: $('#hamburguer') 
						},
					}, menuTemplate));
					$('div[aria-describedby=mainMenu] div.ui-dialog-titlebar').hide();
					
					$('#libraryMenu').dialog($.extend(true,{
						position: { 
							my: "left-5 top+9", 
							at: "left bottom", 
							of: $('#mainMenu') 
						},	
					}, menuTemplate));
					$('div[aria-describedby=libraryMenu] div.ui-dialog-titlebar').hide();
					
					$('#hamburguer').on().click(function() {
						toggleMenu('mainMenu');
					});
					$('#newBackgroundButton').on().click(function (){
						var props = { type: 'background', playmat: id } ;
						fileDialog('/upload',['.jpg','.png','.gif'],'Upload a background', 'File upload', props, function(res){
							$('#mainMenu').dialog('close');
							$('#libraryMenu').dialog('close');
							if (res.objects) {
								processBoard(res.objects);
							}
						});
					});
					$('#loadTokenButton').on().click(function (){
						var props = { type: 'token', playmat: id, x: $(window).scrollLeft(), y: $(window).scrollTop() } ;
						fileDialog('/upload',['.jpg','.png','.gif'],'Upload a token', 'File upload', props, function(res){
							$('#mainMenu').dialog('close');
							$('#libraryMenu').dialog('close');
							if (res.objects) {
								processBoard(res.objects);
							}
						});
					});
					$('#openLibraryButton').on().click(function (){
						toggleMenu('libraryMenu');
					});	
					
				}
			});
		</script>
	</head>
	<body>
		<input id="playmatId" type="hidden" value="-1"/>
		<div class="hamburguer" id="hamburguer">&#9776;</div>
		<div class="dialog" id="mainMenu" style="display: none">
			<div class="menuSelection" id="newBackgroundButton"    >New background</div>
			<div class="menuSelection" id="loadTokenButton"        >Load token</div>
			<div class="menuSelection" id="openLibraryButton"      >Open library</div>
			<div class="menuSelection" id="destroyPlaymatButton"   >Destroy playmat</div>
			<div class="menuSelection" id="exitButton"             >Exit</div>
		</div>
		<div class="dialog" id="libraryMenu" style="display: none" parentMenu="mainMenu">
			<div class="menuSelection" id="backgroundLibraryButton">Background library</div>
			<div class="menuSelection" id="tokenLibraryButton"     >Token library</div>
		</div>
	</body>
</html>