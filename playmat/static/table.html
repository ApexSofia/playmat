<!DOCTYPE HTML>
<html lang="en">
	<head>
		<title>Playmat for role playing games</title>
		<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
		<script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>
		<script src="./helper.js"></script>
		<link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/ui-darkness/jquery-ui.css">
		<link rel="stylesheet" type="text/css" href="./style.css">
		<link rel="icon" type="image/x-icon" href="favicon.ico">
		<script>
			$(function() {
				var processBoard = function(objects){
					for (var i = 0 ; i < objects.length ; i++) {
						var obj = objects[i] ;
						if (obj.type == 'background') {
							$('body').css('background-image','none');
							$('body').css('background-color','#000000');
							if (!exists('object_'+obj.rowid)) {
								var name = obj.name ;
								var img = '<img '
								if (obj.name.indexOf('http://') == 0 || obj.name.indexOf('https://') == 0) {
									img = img + 'src="'+obj.name+'" ';
								} else {
									img = img + 'src="./assets/'+obj.name+'" ';
								}
								img = img + 'id="object_'+obj.rowid+'" style="position:absolute; left:0px; top:0px">' ;
								$('body').append(img);
							}
						}
					}
				};
				
				var menuTemplate = {
					autoOpen: false,
					width: 410,
					show: {
						effect: "blind",
						duration: 500
					},
					hide: {
						effect: "blind",
						duration: 500
					}
				};
			
				var id = $('#playmatId').val();
				if (id == -1) {
					betterAlert('An error has ocurrerd, redirecting to main screen', 'Error', function(){
						window.location.href = 'index.html' ;
					});
				} else {
					processBoard(JSON.parse($('#initialData').val()));
				
					$('#mainMenu').dialog($.extend(true,{
						title: 'Main menu',
						position: { 
							my: "left top+5", 
							at: "left bottom", 
							of: $('#hamburguer') 
						},
					}, menuTemplate));
					$('div[aria-describedby=mainMenu] div.ui-dialog-titlebar').hide();
					
					$('#libraryMenu').dialog($.extend(true,{
						position: { 
							my: "left-5 top+9", 
							at: "left bottom", 
							of: $('#mainMenu') 
						},	
					}, menuTemplate));
					$('div[aria-describedby=libraryMenu] div.ui-dialog-titlebar').hide();
					
					$('#hamburguer').on().click(function() {
						toggleMenu('mainMenu');
					});
					$('#newBackgroundButton').on().click(function (){
						fileDialog('/upload',['.jpg','.png','.gif'],'Upload a background', 'File upload', { type: 'background', playmat: id }, function(){
							$('#mainMenu').dialog('close');
							$('#libraryMenu').dialog('close');
						});
					});
					$('#openLibraryButton').on().click(function (){
						toggleMenu('libraryMenu');
					});	
					
				}
			});
		</script>
	</head>
	<body>
		<input id="playmatId" type="hidden" value="-1"/>
		<div class="hamburguer" id="hamburguer">&#9776;</div>
		<div class="dialog" id="mainMenu" style="display: none">
			<div class="menuSelection" id="newBackgroundButton"    >New background</div>
			<div class="menuSelection" id="loadTokenButton"        >Load token</div>
			<div class="menuSelection" id="openLibraryButton"      >Open library</div>
			<div class="menuSelection" id="destroyPlaymatButton"   >Destroy playmat</div>
			<div class="menuSelection" id="exitButton"             >Exit</div>
		</div>
		<div class="dialog" id="libraryMenu" style="display: none" parentMenu="mainMenu">
			<div class="menuSelection" id="backgroundLibraryButton">Background library</div>
			<div class="menuSelection" id="tokenLibraryButton"     >Token library</div>
		</div>
	</body>
</html>